name: Generate CompanyCultureHub Sites

# Trigger: Bei Push in content/ Ordner oder manuell
on:
  push:
    branches:
      - main  # Nur auf dem main-Branch ausfÃ¼hren
    paths:
      - 'content/**'
      - 'templates/**'
      - 'scripts/**'
  workflow_dispatch:  # Manueller Trigger

# Berechtigungen fÃ¼r GitHub Pages
permissions:
  contents: write # NÃ¶tig, um Ã„nderungen in den docs-Ordner zu pushen
  pages: write
  id-token: write

# Nur ein Deployment gleichzeitig
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  generate-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Repository auschecken
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    # 2. Python Setup
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    # 3. Python Dependencies installieren (falls vorhanden)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f scripts/requirements.txt ]; then
          pip install -r scripts/requirements.txt
        fi
        
    # 4. Websites mit unserem Python-Skript generieren
    - name: ğŸš€ Generate Websites
      run: |
        python scripts/generate_site.py --all
        
    # 5. Generierte Dateien zum Repository hinzufÃ¼gen
    - name: ğŸ’¾ Commit and Push Changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add docs/
        # PrÃ¼fen, ob es Ã„nderungen gibt, bevor wir committen
        if ! git diff --staged --quiet; then
          git commit -m "Automated build: Generate website from content"
          git push
        else
          echo "No changes to commit."
        fi

    # 6. GitHub Pages Setup
    - name: ğŸ”§ Setup Pages
      uses: actions/configure-pages@v4
      
    # 7. Artifacts fÃ¼r Pages vorbereiten
    - name: ğŸ“¤ Upload Pages Artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './docs'
        
    # 8. Zu GitHub Pages deployen
    - name: ğŸŒ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
